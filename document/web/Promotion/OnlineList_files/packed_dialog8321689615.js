(function(){var x=window.dui||{},e="dui-dialog",u=[],r=null,f=($.browser.msie&&$.browser.version==="6.0")?true:false,d={},q={},b="dui-dialog",k="dui-dialog-close",z="j_close_dialog",a="dui-dialog-shd",p="dui-dialog-content",l="dui-dialog-iframe",o="确定",c="取消",t="提示",m="下载中，请稍候...",i='<div id="{ID}" class="'+b+' {CLS}" style="{CSS_ISHIDE}">				<span class="'+a+'"></span>				<div class="'+p+'">          {BN_CLOSE}					{TITLE}					<div class="bd">{BODY}</div>				</div>			</div>',g='<a href="#" class="'+z+" "+k+'">X</a>',j='<div class="hd"><h3>{TITLE}</h3></div>',v='<iframe class="'+l+'"></iframe>',n={confirm:{text:o,method:function(A){A.close()}},cancel:{text:c,method:function(A){A.close()}}},y={url:"",nodeId:"",cls:"",content:"",title:t,width:0,height:0,visible:false,iframe:false,maxWidth:960,autoupdate:false,cache:true,buttons:[],callback:null,dataType:"text",isStick:false,isHideClose:false,isHideTitle:false},h=function(D,C){var A={},B;for(B in C){if(C.hasOwnProperty(B)){A[B]=D[B]||C[B]}}return A},w=function(F){var C=F.elements,B=0,D,E=[],A={"select-one":function(G){return encodeURIComponent(G.name)+"="+encodeURIComponent(G.options[G.selectedIndex].value)},"select-multiple":function(J){var I=0,H,G=[];for(;H=J.options[I++];){if(H.selected){G.push(encodeURIComponent(J.name)+"="+encodeURIComponent(H.value))}}return G.join("&")},radio:function(G){if(G.checked){return encodeURIComponent(G.name)+"="+encodeURIComponent(G.value)}},checkbox:function(G){if(G.checked){return encodeURIComponent(G.name)+"="+encodeURIComponent(G.value)}}};for(;D=C[B++];){if(A[D.type]){E.push(A[D.type](D))}else{E.push(encodeURIComponent(D.name)+"="+encodeURIComponent(D.value))}}return E.join("&").replace(/\&{2,}/g,"&")},s=function(A){var B=A||{};this.config=h(B,y);this.init()};s.prototype={init:function(){if(!this.config){return}this.render();this.bind();return this},render:function(C){var A=this.config,D=A.nodeId||e+u.length;u.push(D);var B=typeof A.content==="object"?$(A.content).html():A.content;$("body").append(i.replace("{ID}",D).replace("{CSS_ISHIDE}",A.visible?"":"visibility:hidden;top:-999em;left:-999em;").replace("{CLS}",A.cls).replace("{TITLE}",j.replace("{TITLE}",A.title)).replace("{BN_CLOSE}",g).replace("{BODY}",B||C||""));this.nodeId=D;this.node=$("#"+D);this.title=$(".hd",this.node);this.body=$(".bd",this.node);this.btnClose=$("."+k,this.node);this.shadow=$("."+a,this.node);this.iframe=$("."+l,this.node);this.set(A);return this},bind:function(){var A=this;$(window).bind({resize:function(){if(f){return}A.updatePosition()},scroll:function(){if(!f){return}A.updatePosition()}});A.node.delegate("."+z,"click",function(B){A.close();B.preventDefault()});A.node.find("."+k).bind("click",function(B){A.close();B.preventDefault()});$("body").keypress(function(B){if(B.keyCode===27){A.close()}});return this},updateSize:function(){var B=this.node.width(),C,D=$(window).height(),A=this.config;$(".bd",this.node).css({height:"auto","overflow-x":"visible","overflow-y":"visible"});C=this.node.height();if(B>A.maxWidth){B=A.maxWidth;this.node.css("width",B+"px")}if(C>D){$(".bd",this.node).css({height:(D-150)+"px","overflow-x":"hidden","overflow-y":"auto"})}C=this.node.height();this.shadow.width(B);this.shadow.height(C);this.iframe.width(B+16).height(C+16);return this},updatePosition:function(){if(this.config.isStick){return}var A=this.node.width(),C=this.node.height(),D=$(window),B=f?D.scrollTop():0;this.node.css({left:Math.floor(D.width()/2-A/2-8)+"px",top:Math.floor(D.height()/2-C/2-8)+B+"px"});return this},set:function(F){var H,K,B,C,A=this.nodeId,I=this.nodeId||I,D=[],E=this,J=function(L){D.push(0);return A+"-"+L+"-"+D.length};if(!F){return this}if(F.width){this.node.css("width",F.width+"px");this.config.width=F.width}if(F.height){this.node.css("height",F.height+"px");this.config.height=F.height}if($.isArray(F.buttons)&&F.buttons[0]){C=$(".ft",this.node);B=[];$(F.buttons).each(function(){var M=arguments[1],L=J("bn");if(typeof M==="string"){M=n[M]}if(!M.text){return}if(M.href){B.push('<a class="'+(M.cls||"")+'" id="'+L+'" href="'+M.href+'">'+M.text+"</a> ")}else{B.push('<span class="bn-flat '+(M.cls||"")+'"><input type="button" id="'+L+'" class="'+I+'-bn" value="'+M.text+'" /></span> ')}q[L]=M.method});if(!C[0]){C=this.body.parent().append('<div class="ft">'+B.join("")+"</div>")}else{C.html(B.join(""))}this.footer=$(".ft",this.node);$(".ft input, .ft a",this.node).click(function(N){var M=this.id&&q[this.id];if(M){var L=M.call(this,E)}if(L){N.preventDefault();if(typeof L=="string"){alert(L)}}})}else{this.footer=$(".ft",this.node);this.footer.html("")}if(typeof F.isHideClose!=="undefined"){if(F.isHideClose){this.btnClose.hide()}else{this.btnClose.show()}this.config.isHideClose=F.isHideClose}if(typeof F.isHideTitle!=="undefined"){if(F.isHideTitle){this.title.hide()}else{this.title.show()}this.config.isHideTitle=F.isHideTitle}if(F.title){this.setTitle(F.title);this.config.title=F.title}if(typeof F.iframe!=="undefined"){if(!F.iframe){this.iframe.hide()}else{if(!this.iframe[0]){this.node.prepend(v);this.iframe=$("."+l,this.node)}else{this.iframe.show()}}this.config.iframe=F.iframe}if(F.content){this.body.html(typeof F.content==="object"?$(F.content).html():F.content);this.config.content=F.content}if(F.url){if(F.cache&&d[F.url]){if(F.dataType==="text"||!F.dataType){this.setContent(d[F.url])}if(F.callback){F.callback(d[F.url],this)}}else{if(F.dataType==="json"){this.setContent(m);if(this.footer){this.footer.hide()}$.getJSON(F.url,function(L){E.footer.show();d[F.url]=L;if(F.callback){F.callback(L,E)}})}else{this.setContent(m);if(this.footer){this.footer.hide()}$.ajax({url:F.url,dataType:F.dataType,success:function(L){d[F.url]=L;if(E.footer){E.footer.show()}E.setContent(L);if(F.callback){F.callback(L,E)}}})}}}var G=F.position;if(G){this.node.css({left:G[0]+"px",top:G[1]+"px"})}if(typeof F.autoupdate==="boolean"){this.config.autoupdate=F.autoupdate}if(typeof F.isStick==="boolean"){if(F.isStick){this.node[0].style.position="absolute"}else{this.node[0].style.position=""}this.config.isStick=F.isStick}return this.update()},update:function(){this.updateSize();this.updatePosition();return this},setContent:function(A){this.body.html(A);return this.update()},setTitle:function(A){$("h3",this.title).html(A);return this},submit:function(C){var A=this,B=$("form",this.node);B.submit(function(G){G.preventDefault();var D=this.getAttribute("action",2),E=this.getAttribute("method")||"get",F=w(this);$[E.toLowerCase()](D,F,function(H){if(C){C(H)}},"json")});B.submit()},open:function(){this.node.appendTo("body").css("visibility","visible").show();var A=this,B=A.body[0];A.contentHeight=B.offsetHeight;this.watcher=!this.config.autoupdate?0:setInterval(function(){if(B.offsetHeight===A.contentHeight){return}A.update();A.contentHeight=B.offsetHeight},100);return this},close:function(){this.node.hide();this.node.trigger("dialog:close",this);clearInterval(this.watcher);return this}};x.Dialog=function(A,B){if(!B&&r){return A?r.set(A):r}if(!r&&!B){r=new s(A);return r}return new s(A)};window.dui=x})();