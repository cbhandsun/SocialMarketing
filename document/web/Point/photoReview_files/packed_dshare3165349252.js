(function(g,A,z,y,w){if(typeof DoubanShare!=="undefined"){return}var p={},t=[],k="http://img3.douban.com/anduin/dshare-3.css",m="http://img3.douban.com/pics/loading.gif",h=".lnk-douban-sharing",e='<div id="dbshare-loading" style="position:absolute;left:50%;top:50%;margin:-20px 0 0 -25px;*margin-top:-40px;background:#fff;color:#333;line-height:1.2;font-size:14px;padding:0 10px;">加载中...</div>',j='<div style="padding:30px 0;text-align:center;font-size:14px;color:#060;">分享成功!</div>',d=["<!DOCTYPE HTML>",'<html lang="zh-CN"><head><meta charset="UTF-8"><title></title>','<link href="'+k+'" rel="stylesheet" type="text/css">',"<script>","function autoHeight(){ ","  var $$ = parent.$;",'  $$("#" + document.body.id).height(document.body.offsetHeight).css("visibility","visible");',"}","<\/script>",'</head><body id="{ID}">','<div id="wrapper">{CONTENT}</div>',"<script> ","window.onload=function(){","autoHeight(); ","}","<\/script>","</body></html>"].join(""),n=["<!DOCTYPE HTML>",'<html lang="zh-CN"><head><meta charset="UTF-8"><title></title>','<link href="'+k+'" rel="stylesheet" type="text/css">',"<script>","function autoHeight(){ ","  var $$ = parent.$;",'  $$("#" + document.body.id).height(document.body.offsetHeight).css("visibility","visible");',"}","<\/script>",'</head><body id="{ID}">','<div id="wrapper">{CONTENT}</div>',"<script> ","window.onload=function(){","autoHeight(); ","}","<\/script>","</body></html>"].join(""),r='<div class="rectitle"><span class="gact rr"><a href="#" class="lnk-close">x</a></span><span class="m" >{TITLE}</span></div><div class="bd" style="position:relative;line-height:0;font-size:0;"></div>',a=function(C,E,B){var D;if(/device-mobile/i.test(document.documentElement.className)){B=document.documentElement.clientWidth*0.9}if(typeof dui!=="undefined"&&dui.Dialog){D=dui.Dialog({width:B||500,content:C,iframe:1,title:E,isHideClose:0},true).open();D.node.addClass("dui-dialog-rec").find(".bd").css({position:"relative",padding:"10px 0 0 0","line-height":0,"font-size":0})}else{D=$("#dialog");if(D.length===0){$('<div id="overlay"></div><div id="dialog" class="dialog-shuo"  style="width:'+(B||500)+'px;"></div>').appendTo("body");D=$("#dialog")}D.html(C);l();D.find(".lnk-close").click(function(F){F.preventDefault();c()})}return D},l=function(){if(typeof dui!=="undefined"&&dui.Dialog&&p.currentDialog){p.currentDialog.update();return}var D=($.browser.msie)?-2:16,C=$("#dialog")[0],B=C.offsetWidth,E=(A.body.offsetWidth-B)/2;$("#overlay").css({height:C.offsetHeight+D,width:B+16,left:(E+5)+"px"});C.style.left=E+"px"},c=function(){if(typeof dui!=="undefined"&&dui.Dialog&&p.currentDialog){p.currentDialog.close();q.fire();return}$("#overlay, #dialog").remove();q.fire()},x=function(){t.push(1);return"db-sharing-iframe"+t.length},o=function(){var B=A.createElement("iframe");B.setAttribute("scrolling","no");B.setAttribute("frameBorder","0");B.setAttribute("width","100%");B.setAttribute("allowTransparency","true");B.src="";return B},b=function(J){var B=o(),E=x()+(+(new Date))+(0|Math.random()*1000000),D=J.css||"",I=J.text||"",H=J.heading||"推荐到豆瓣",G,C=(J.image==="")?230:280,F=a(r.replace("{TITLE}",H),H,J.width);p.currentDialog=F;B.setAttribute("id",E);B.setAttribute("height",J.height||C);B.src=z+$.param(J)+"&alt=xd&callback=DoubanShare.callback&_stamp="+E+"&_time="+(+new Date());if(F.node){F.node.find(".bd").css("background","url("+m+") 48% 48% no-repeat").html("").append(B)}else{F.find(".bd").css("background","url("+m+") 48% 48% no-repeat").html("").append(B)}l();(new Image()).src="http://www.douban.com/blank?shuo_msg=loadingd&shuo_id="+E},s=function(C,B){p.numCallback=function(D){if(D.n_votes>0){C.before('<span class="rec-num"><b>'+D.n_votes+"人推荐</b></span>")}};$.ajax({url:y+$.param(B)+"&alt=xd&callback=DoubanShare.numCallback",dataType:"script"})},f=function(D,C){var B=o(),E=x();B.setAttribute("id",E);B.setAttribute("height",100);B.style.visibility="hidden";p.commentsCallBack=function(F){if(F.error!==""){return}if(F.n_votes>0){D.after('<span class="rec-num"><b>'+F.n_votes+"人推荐</b></span>")}D.parents(".rec-comments").after(B);var G=$("#"+F.target_id)[0].contentWindow.document;G.open();G.write(n.replace("{CONTENT}",F.result).replace("{ID}",F.target_id));G.close()};$.ajax({url:w+$.param(C)+"&iframeid="+E+"&alt=xd&callback=DoubanShare.commentsCallBack",dataType:"script"})},i=function(C){var B=C.data();if(!B.href||!B.mode){return}if((B.mode+"|").indexOf("num")+1){s(C,B)}if((B.mode+"|").indexOf("comments")+1){f(C,B)}},q=function(B){q.callback.push(B)},v=function(B){b(B)},u=function(){$("html").delegate(h,"click",function(D){var C=$(D.currentTarget),B=C.data();D.preventDefault();b(B)});$(function(){$(h).each(function(){i($(this))})})};q.callback=[];q.fire=function(){while(q.callback.length){(q.callback.pop())()}};u();p.cacheUrl={};p.updateDialog=function(B){var C=p.currentDialog;if(C.node){C.node.find("iframe").css("height",B+"px");C.update();return}if(B){$("#dialog iframe").css("height",B+"px")}l()};p.closeDialog=function(){var B=p.currentDialog;if(B.node){B.node.find(".hd").hide();B.node.find(".bd").css("background","none").html(j)}else{B.find(".rectitle").hide();B.find(".bd").css("background","none").html(j)}l();setTimeout(function(){c()},1000)};p.share=v;p.onDialogClose=q;g.DoubanShare=p;(new Image()).src=m})(window,document,rec_url,num_url,comments_url);function exp_dialog(a){var b=document.documentElement;return 0-parseInt(a.offsetHeight/2)+(TBWindowMargin=b&&b.scrollTop||document.body.scrollTop)+"px"}function exp_overlay(a){return 0-parseInt(a.offsetHeight/2)+(TBWindowMargin=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)+"px"};