~function(a){if(window.define===undefined){a(jQuery)}else{define("imap",["jquery","google_map"],a)}}(function(b){var a=window.dui||{};a.log=function(c){if(typeof(console)!="undefined"&&typeof(console.log)=="function"){console.log(c)}};a.iMap=(function(){var k={width:500,height:400,lat:39.92,lng:116.46,zoom:8,type:"ROADMAP",callback:""},c={lat:k.lat,lng:k.lng,latLng:function(){return new google.maps.LatLng(k.lat,k.lng)}(),draggable:false,handleDragStart:function(){},handleDragEnd:function(){},handleDrag:function(){},clickable:false,handleClick:function(){},visible:true},f={disableDefaultUI:false,panControl:true,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR},scaleControl:true,streetViewControl:false,overviewMapControl:false,searchControl:false,searchCallback:""},p={lat:k.lat,lng:k.lng,latLng:function(){return new google.maps.LatLng(k.lat,k.lng)}()},j=b.extend(k,f),n=[],l=[];function t(w,u){var v=b.extend(p,u||{});w.setCenter(v.latLng)}function r(u){return !!u&&!u.nodeName&&u.constructor!=String&&u.constructor!=RegExp&&u.constructor!=Array&&/function/i.test(u+"")}function d(x,u){var v=b.extend(j,u||{});x.css({width:v.width,height:v.height});v.mapTypeId=google.maps.MapTypeId[v.type];var w=new google.maps.Map(x.get(0),v),y=new google.maps.LatLng(v.lat,v.lng);w.setCenter(y);if(r(v.callback)){v.callback(w)}if(v.searchControl){s(w,v.searchControlOptions,v.searchCallback)}return w}function i(y,w){var x=b.extend(c,w||{});var v={position:x.latLng,map:y,draggable:x.draggable,cilckable:x.clickable};if(w.icon){v.icon=new google.maps.MarkerImage(w.icon.url,new google.maps.Size(w.icon.size[0],w.icon.size[1]),new google.maps.Point(0,0),new google.maps.Point(w.icon.size[0]/3,w.icon.size[1]))}var u=new google.maps.Marker(v);if(x.draggable&&x.handleDrag&&r(x.handleDrag)){google.maps.event.addListener(u,"drag",x.handleDrag)}if(x.draggable&&x.handleDragStart&&r(x.handleDragStart)){google.maps.event.addListener(u,"dragstart",x.handleDragStart)}if(x.draggable&&x.handleDragEnd&&r(x.handleDragEnd)){google.maps.event.addListener(u,"dragend",x.handleDragEnd)}if(x.clickable&&x.handleClick&&r(x.handleClick)){google.maps.event.addListener(u,"click",x.handleClick)}n.push(u);return u}function e(u){for(var v=0;v<u.length;v++){u[v].setMap(null)}}function m(w,u,v){switch(u){case"click":google.maps.event.addListener(w,"click",v);break;case"zoom":google.maps.event.addListener(w,"zoom_changed",v);break;case"drag":google.maps.event.addListener(w,"drag",v);break;case"dragstart":google.maps.event.addListener(w,"dragstart",v);break;case"dragend":google.maps.event.addListener(w,"dragend",v);break;default:}}function s(z,w,A){var y=b('<div id="search-control"></div>'),v=b('<div id="search-control-ui"></div>'),u=b('<input type="text" name="search-txt" id="search-txt" />'),x=b('<input type="button" id="btn-search" value="'+(w.text||"搜索")+'" />');v.append(u).append(x);y.append(v);if(w.targetNode){w.targetNode.empty().append(y)}else{z.controls[google.maps.ControlPosition.TOP_LEFT].push(y.get(0))}google.maps.event.addDomListener(x.get(0),"click",function(){o({map:z,address:u.val(),city:w.city||"",district:w.district||"",success:w.callback_search})});u.bind("keydown",function(B){if(B.keyCode=="13"){o({map:z,address:u.val(),city:w.city||"",district:w.district||"",success:w.callback_search})}});u.autocomplete({source:function(D,B){var E=new google.maps.Geocoder();var C=(w.city||"")+" "+(w.district||"")+" "+D.term;E.geocode({address:C},function(G,F){B(b.map(G,function(H){return{label:H.formatted_address,value:H.formatted_address,latitude:H.geometry.location.lat(),longitude:H.geometry.location.lng()}}))})},select:function(D,E){if(w.callback_search){var F=new google.maps.LatLng(E.item.latitude,E.item.longitude);w.callback_search(z,{geometry:{location:F}});return}if(n.length){b.each(n,function(H,G){G.setMap(null)})}var C=new google.maps.LatLng(E.item.latitude,E.item.longitude),B=i(z,{latLng:C});t(z,{latLng:C});z.setZoom(15)}});w.callback_inited&&w.callback_inited()}function o(u){var x={ele:"",map:"",address:"",zoom:15,success:"",fail:""},v=b.extend(x,u||{});if(n&&n.length&&!v.success){e(n)}if(l&&l.length&&!v.success){e(l)}var w=new google.maps.Geocoder();w.geocode({address:(v.city||"")+(v.district||"")+v.address},function(A,z){if(z==google.maps.GeocoderStatus.OK){v.map.setZoom(v.zoom);if(r(v.success)){v.success(v.map,A[0])}else{var C=A[0].geometry.location,y=i(v.map,{draggable:false,latLng:C}),B='<div class="info-window"><div class="info-win-hd">'+A[0].formatted_address+'</div><div class="info-win-bd"><a target="_blank" href="http://ditu.google.cn/maps?hl=zh-CN&ie=UTF8&dirflg=r&f=d&daddr='+A[0].formatted_address+'">驾车/公交路线</a></div></div>',D=a.iMap.infowindow(v.map,y,{content:B});t(v.map,{latLng:C});D.open(v.map,y)}b(v.ele).data("latLng",A[0].geometry.location)}else{if(r(v.fail)){v.fail(v.map)}}})}function h(z,u,v){var y={content:"",maxWidth:200,maxHeight:100,autoScroll:true},w=b.extend(y,v||{}),x=new google.maps.InfoWindow({content:w.content,maxWidth:w.maxWidth,maxHeight:w.maxHeight,autoScroll:w.autoScroll});l.push(x);google.maps.event.addListener(u,"click",function(){x.open(z,u)});return x}function q(v){var x={latLng:"",callback:function(){}},w=b.extend(x,v||{}),u=new google.maps.Geocoder();u.geocode({latLng:w.latLng},function(z,y){if(y===google.maps.GeocoderStatus.OK&&r(w.callback)){w.callback(z[0])}})}function g(v){var y={center:"beijing",size:"400x300",zoom:"16",maptype:"roadmap"},x=b.extend(y,v||{}),u="http://maps.google.cn/maps/api/staticmap?center="+x.center+"&size="+x.size+"&zoom="+x.zoom+"&markers="+x.center+"&maptype="+x.maptype+"&sensor=false",w=b('<img src="'+u+'" alt="google static map" />');return w}return{createMap:function(u,v){return d(u,v)},setCenter:function(v,u){t(v,u)},createMarker:function(v,u){return i(v,u)},removeOverlay:function(u){e(u)},bind:function(w,u,v){m(w,u,v)},search:function(u){return o(u)},infowindow:function(w,u,v){return h(w,u,v)},addressLookup:function(u){q(u)},staticMap:function(u){return g(u)}}})();window.dui=a});