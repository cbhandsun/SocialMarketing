Do.init_show_signup_table=function(b,a){$("body").delegate(".j_show_signup_table","click",function(c){c.preventDefault();Do.show_signup_table(b,a)})};Do(function(){var g,b,e,c;Do.show_signup_table=function(h,i){e=h||window._event_id_;c=i||window._ck_;$.ajax({type:"GET",url:"/j/location/get_signup_table",data:{ck:c,event_id:e},success:function(k){if(!k||k.r||!k.html){alert(k.error||"加载报名表失败!");window.location.reload()}var j=setInterval(function(){if(g){g.set({width:440,content:k.html});f(g);clearInterval(j)}},80);Do.show_signup_table=d}});Do("dialog",function(){g=dui.Dialog({nodeId:"win-signup-table",title:"报名表",width:"350",content:'<div style="text-align:center; height:50px;line-height:50px;">加载中，请稍后...</div>'},true);g.open()})};function d(){g&&g.open()}function f(h){$("#form-signup").submit(function(l){l.preventDefault();var i=$(this);var k=i.find("input"),m=false;$.each(k,function(n,p){$item=$(p);var o=$item.parent().find(".error-info");if(p.name=="email"){if(!$item.val()){o.html("请填写邮箱");m=true}else{if(!/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test($item.val())){o.html("请正确填写邮箱");m=true}else{o.html("")}}}else{if(p.name=="cellphone"){if(!$item.val()){o.html("请填写电话");m=true}else{if(!/^\d+(\-)?\d+$/.test($item.val())){o.html("请正确填写电话");m=true}else{o.html("")}}}else{if(p.name.match("question")){if(!$item.val()){o.html("请填写问题答案");m=true}else{o.html("")}}}}});if(!m){var j=$("#form-signup").serialize();if(!window._group_event_){j+="&follow_up=interest_comment"}$.ajax({type:"POST",url:"/j/location/signup",data:j,success:a})}}).find("input.basic_input:eq(0)").focus()}function a(i){if(!i||i.r){var h=i.error||"出错啦";g.setContent(h+'，请<a href="">刷新页面</a>后重试');g.update()}else{if(i.html&&Do.update_interest_status){g.close();Do.update_interest_status(i);Do.show_event_collect_comment(i)}else{document.location.reload()}}}});Do(function(){var a=/{(.+?)}/g;$.substitute=function(c,b){return c.replace(a,function(e,d){return typeof b[d]==="undefined"?"":b[d]})}});Do(function(){var k='<select id="attend-dates">{items}</select>';var h=String('<option {meta} value="{d}">{text}</option>');var j;Do.init_show_attend_time=function(n,m){m=m||".act-attend";$("body").delegate(m,"click",function(r){r.preventDefault();var q=$(this);g(q.hasClass("j_show_signup_table"),q.data("eid")||window._event_id_,q.data("dates")||n);var o=q.data("now");if(!o){return}var p=o.split("T")[0];setTimeout(function(){j&&j.body.find("option").each(function(s,t){t=$(t);var u=t.val().split("T")[0];if(u==p){t.parent().focus();b(t);return false}})},50)})};Do.date_select_items=function(p){var q,o,m=0;for(var n=p.length-1;n>=0;n--){q=new Date(p[n]);o={meta:"",text:d(p[n]),d:p[n]};p[n]=$.substitute(h,o)}return p};var c=new Date();var g=function(m,n,o){Do("dialog",function(){n=n||$.uuid++;j=f(m,n,o);j.open();g=a})};function b(m){e[j.eid]=$(m).attr("selected",true).val()}function a(m,n,o){if(!j){return}j.close();f(m,n,o).open()}var i=Do.dialogs||(Do.dialogs={});var e={};function f(o,p,q){j=i[p];if(j){return j}q=Do.date_select_items(q);var m=q.length;var n={cls:"win-attend-time",title:"设置参加日期",width:260,content:k.replace("{items}",q.join(""))};n.buttons=[{cls:"bn-flat",text:o?"下一步":"确定",method:function(s){var r=s.body.find("select").val();if(!r){alert("请选择日期!")}if(o){window._attend_time_=r;s.close();Do.show_signup_table()}else{setTimeout(function(){s.footer.html("处理中...");s.updateSize()},300);$.post("/j/location/event_interest",{ck:window._ck_,id:p,interest:"do",attend_time:r},function(t){if(t&&!t.r){window.location.reload()}else{alert("抱歉, 修改失败! 请刷新页面重试")}})}}},"cancel"];j=i[p]=dui.Dialog(n,true);j.body.find("select").bind("change",function(s){var r=$(this.options[this.selectedIndex]);j.setTitle("已选择："+r.text())});j.eid=p;return j}var l="日一二三四五六";function d(m){var p,r,w,s,q,u,o,n,v;p=m.split("T");r=p[0].split("-");if(p[1]){r=r.concat(p[1].split(":"))}m=new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5]);return(m.getMonth()+1)+"月"+m.getDate()+"日<br />(周"+l[m.getDay()]+") "+((r[3]&&r[4])?(r[3]+":"+r[4]):"")}});Do(function(){var b;Do.show_event_collect_comment=function(c){if(b){return b.open()}a(c)};function a(c){Do("dialog",function(){var g=c.interest=="do";b=dui.Dialog({cls:"win-collect",title:'<span class="tick-ok">'+(g?"我要参加这个活动":"我对这个活动感兴趣")+"</span>",width:520,content:c.html},true);b.open();b.body.find("select,textarea")[0].focus();Do("tagsug",function(){b.body.find("textarea").tagsug({useUid:true})});if(!b.body.find("select")){var h=b.body.find(".share-label input");var f=b.body.find(".bn-flat input");h.bind("change",function(i){if(!h.filter(":checked").length){e()}else{d()}});function e(){f.attr("disabled",true);f.addClass("disabled")}function d(){f.removeAttr("disabled");f.removeClass("disabled")}}});a=function(){}}});Do(function(){var b=Do.dialogs||(Do.dialogs={});var c={container:"#event-act",btns:".collect_btn",follow_up:"interest_comment"};var a={"do":"我要参加",wish:"我感兴趣"};var d='<a class="j a_confirm_link gact" href="?interest=do_cancel&ck={ck}">取消</a>';Do.update_interest_status=function(f){var g=f.interest||"do";var e='<span class="tick-ok">'+a[g]+"</span> "+$.substitute(d,{id:f.event_id,ck:f.ck});$("#event-act").html(e)};Do.init_collect_event=function(i){var i=$.extend({},c,i);var g=$(i.container);var h=i.eid;var l=i.interest;var f=false;var j={ck:window._ck_,event_id:h||window._event_id_,follow_up:i.follow_up};function k(){if(!f){g.addClass("ing")}}function e(m){f=true;g.removeClass("ing");Do.update_interest_status(j)}g.delegate(i.btns,"click",function(n){var m=$(this);j.interest=m.data("interest")||j.interest;n.preventDefault();if(m.hasClass("j_show_signup_table")){Do.show_signup_table(j.id,j.ck);return}setTimeout(k,600);$.post("/j/location/event_interest",j,function(o){e(m.text());if(o&&!o.r){if(o.html){j.html=o.html;Do.show_event_collect_comment(j);return}else{window.location.reload()}}if(o.msg){alert(o.msg);window.location.reload()}})})}});